!function(){"use strict";const t=()=>{try{const t=JSON.parse(window.localStorage?.getItem("zephr")||"{}")||{};return t&&"object"==typeof t?t:{}}catch(t){return{}}},e=t=>{const e=document.cookie.split(";").map((t=>t.trim()));for(let o=0;o<e.length;o+=1){const[r="",n=""]=e[o].split("=");if(r===t)return n}return null},o=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8e3;const r=e("_autid");if(r)return void t(r);let n=!1;const i=setTimeout((()=>{n||t(null)}),o);window.addEventListener("nyp-aqfer:aut-cookie-ready",(o=>{clearTimeout(i);const{detail:{aut:r=e("_autid")}={}}=o;n=!0,t(r),clearTimeout(i)}))},r=async()=>{if(!window.crypto||!window.crypto.subtle)throw new Error("Crypto not supported");return await window.crypto.subtle.importKey("raw",(new TextEncoder).encode("IN6H1akL63KYAE69bY6GSvTSc0qjip9m"),{name:"AES-GCM"},!1,["encrypt","decrypt"])},n=async t=>btoa(JSON.stringify(await(async t=>{try{if(!window.crypto||!window.crypto.subtle)throw new Error("Crypto not supported");const e=crypto.getRandomValues(new Uint8Array(12)),o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e},await r(),(new TextEncoder).encode(JSON.stringify(t)));return{data:btoa(String.fromCharCode(...new Uint8Array(o))),iv:btoa(String.fromCharCode(...e))}}catch(e){return console.error("Aqfer Error encrypting data, falling back to base64:",e),{data:btoa(JSON.stringify(t)),iv:""}}})(t))),i=async(t,e)=>{const o=`__cachedAqferData_${e}`,i=window.localStorage?.getItem(o);if(i){const{data:t,expiration:e}=await(async t=>{if(t.startsWith("{"))return JSON.parse(t)||{};try{return await async function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const{data:e,iv:o}=JSON.parse(atob(t));return await(async t=>{let{data:e,iv:o}=t;try{if(!window.crypto||!window.crypto.subtle)throw new Error("Crypto not supported");const t=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(Uint8Array.from(atob(o),(t=>t.charCodeAt(0))))},await r(),new Uint8Array(Uint8Array.from(atob(e),(t=>t.charCodeAt(0)))));return JSON.parse((new TextDecoder).decode(t))}catch(t){return console.error("Aqfer Error decrypting data, falling back to base64:",t),JSON.parse(atob(e))}})({data:e,iv:o}).catch((()=>null))}catch(t){return e||console.error("Aqfer Error getting encrypted data/iv from string:",t),null}}(t)}catch(t){console.error("Aqfer Error decrypting data:",t)}return{}})(i)||{};if(t&&e&&e>(new Date).getTime())return t}const{nypAqfer:{aqferAccessToken:a=null,isProduction:s=!1}={}}=window;if(!a||!a.length)throw new Error("No aqferAccessToken found.");return fetch(t,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}).then((t=>t.json())).then((t=>{const e=(new Date).getTime();let r=e+6048e5;return t.error&&t.error.toLowerCase().includes("not found")&&(r=e+864e5),s||(r=e+3e5),n(JSON.stringify({data:t,expiration:r})).then((t=>{window.localStorage?.setItem(o,t)})),t}))};const a=async o=>{if(!o)return console.log("Aqfer: No _autid cookie found for edge lookup."),null;let r=null;return i(`https://graphds-c057.a24365.io/v2/entities/ck~nypost~${o}/edges`,"neighbors").then((i=>{if((async t=>{if(!t||!Array.isArray(t))return void window.localStorage?.removeItem("aqfer");const e=await Promise.all(t.map((async t=>t.type&&"aud4"===t.type?{...t,key:await n(t.key)}:t)));window.localStorage?.setItem("aqfer",JSON.stringify(e))})(i),!Array.isArray(i))return void console.error("Aqfer Neighbors Error","Invalid response from Aqfer.");const a={};i.forEach((t=>{let{type:e,key:o}=t;a[e]||(a[e]=o)})),a.ny_post_id&&(r=a.ny_post_id,window.localStorage?.setItem("nyp_id",a.ny_post_id),window.dispatchEvent(new CustomEvent("nyp-aqfer:nyp-id-ready",{detail:{nypId:r}})));let s=a.em||null;var d;window.nypAqfer.featureFlags.aud4&&(s=s||a.aud4||null),s&&(d=s,e("uid2_identity")||(console.log(`Aqfer: Fetching UID2 token for ${d}`),fetch("https://api.nypdev.com/ads/tradedesk/token",{body:JSON.stringify({email:d}),headers:{Authorization:"Basic QGxsZXk6dmZEVEJPM1Y3cnJ5","Content-Type":"application/json"},method:"POST"}).then((t=>t.ok?t.json():Promise.reject(t))).then((t=>{const{Message:{Data:e}={}}=t;e&&((t,e,o)=>{const r=new Date;r.setTime(r.getTime()+31536e6);const n=`expires=${r.toUTCString()}`;document.cookie=`uid2_identity=${e};${n};path=/`})(0,JSON.stringify(e))})).catch((t=>console.error("Error fetching UID2 token",t)))),(t=>{const e=()=>{const e=window.atsenvelopemodule||window.ats||null;e&&t&&e.setAdditionalData&&e.setAdditionalData({type:"email",id:t})};window.atsenvelopemodule||window.ats?e():window.addEventListener("envelopeModuleReady",e)})(s)),(async e=>{let{aut:o,nypId:r,email:n}=e;const i=[];r&&i.push({id:r,tag:"_nypid-sync",priority:1}),o&&i.push({id:o,tag:"_autid-sync",priority:2});const{user:{sessionId:a=null}={}}=t();if(!a&&n){const t=await(async t=>{if(!crypto)return t;const e=(new TextEncoder).encode(t);return crypto.subtle.digest("SHA-256",e).then((t=>Array.from(new Uint8Array(t)).map((t=>t.toString(16).padStart(2,"0"))).join("")))})(n);i.push({id:t,priority:0,tag:"email_sha256"})}i.length?(window.permutive||console.warn("Aqfer Permutive Error: window.permutive is not defined."),window.permutive?.identify(i),console.log("Aqfer Permutive Identify:",i)):console.log("Aqfer Permutive Error: No IDs to identify.")})({aut:o,nypId:r,email:s})})).catch((t=>console.error("Aqfer Neighbors Error",t)))},s=t=>{window.ga4Dims=window.ga4Dims||{},window.ga4Dims.ga_aut_id=t,void 0!==window.gtag&&window.gtag("event","auttag",window.ga4Dims)},d=()=>{if(!document.cookie)return"";let t="";return document.cookie.split(";").forEach((e=>{e.includes("_autid=")&&(window.ga4Dims=window.ga4Dims||{},window.ga4Dims.ga_aut_id=e.split("=")[1]),e.includes("sailthru_visitor=")&&([,t]=e.split("="))})),t};(async()=>{const e=t(),{user:{account:{emailAddress:r=""}={},trackingId:n=""}={}}=e,{nypAqfer:{featureFlags:{tag:i=!1}={},root:c=""}={}}=window;i&&(window.localStorage?.getItem("__cachedAqferResponse_neighbors")&&window.localStorage?.removeItem("__cachedAqferResponse_neighbors"),(()=>{const{root:t=""}=window.nypAqfer||{};window.addEventListener("message",(e=>{if(e.origin!==t)return;const{data:o}=e;try{const t=JSON.parse(o),{message:e="",sub_autId:r="",sub_ipaddr:n=""}=t;"aut cookie ready"===e&&r&&window.dispatchEvent(new CustomEvent("nyp-aqfer:aut-cookie-ready",{detail:{aut:r}})),localStorage?(r&&localStorage?.setItem("_autId",r),n&&localStorage?.setItem("ipaddr",n)):console.error("localStorage is not supported on this browser for ID5 Identity Resolution")}catch(t){console.log("Aqfer: Error parsing message for ID5 Identity Resolution",t)}}))})(),o(a),o(s),(t=>{const{nypAqfer:{isProduction:e=!1}={}}=window,o=t;e||(o.cls="preprod"),console.log("Aqfer C057Data",o),window.c057Data=o,function(t,e,o,r){var n,i=[],a=t.tt.slice(-1),s={cdmn:1,lm:1,tt:1},d={cid:1,cls:1,dmn:1,pubid:1,evid:1,aq_m:1};for(n in t.dmn=(t.dmn||(o.top[r]===o[r]?""+o[r]:e.referrer).split("/")[2]).split(":")[0],t)(d[n]||("j"!=a||t.aq_m)&&!s[n])&&i.push(n+"="+t[n]);const c=e.createElement("f"==a?"img":"script");c.id=c.title="pxscrpt",c.async=c.defer=!0,c.src="//"+t.cdmn+"/1/"+t.lm+"/"+t.tt+"?"+i.join("&"),e.body.appendChild(c)}(o,document,window,"location")})({cdmn:c.replace("https://",""),lm:"e",tt:"tcs.dhj",aqet:"pv",v0:r,v1:d(),v2:n,v3:"",v4:"",v5:""}))})()}();